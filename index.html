<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢¦å¹»æ³¡æ³¡ç –å— | Sparkle Bricks</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <link href="./styles/main.css" rel="stylesheet">
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

        <!-- æ¸¸æˆUI -->
        <div class="game-ui" id="scorePanel">
            â˜… å¾—åˆ†: <span id="score">0</span>
        </div>
        <div class="game-ui" id="coinPanel">
            ğŸª™ <span id="coins">0</span>
        </div>

        <!-- å¼€å§‹èœå• -->
        <div id="startMenu">
            <h1>âœ¨æ¢¦å¹»æ³¡æ³¡ç –å—âœ¨</h1>
            <button class="game-btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
            <button class="game-btn" id="howToPlayBtn">æ¸¸æˆè¯´æ˜</button>
            <button class="game-btn" id="rankingBtn">æ’è¡Œæ¦œ</button>
        </div>

        <!-- æš‚åœèœå• -->
        <div id="pauseMenu">
            <button class="game-btn" id="resumeBtn">ç»§ç»­æ¸¸æˆ</button>
            <button class="game-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
            <button class="game-btn" id="mainMenuBtn">è¿”å›ä¸»èœå•</button>
        </div>
        
        <!-- æ¸¸æˆè¯´æ˜ -->
        <div id="howToPlay">
            <h2>æ¸¸æˆè¯´æ˜</h2>
            <p>ä½¿ç”¨é¼ æ ‡å·¦å³ç§»åŠ¨æ§åˆ¶æŒ¡æ¿ä½ç½®ã€‚</p>
            <p>ç‚¹å‡»é¼ æ ‡å¯ä»¥æ¿€æ´»æ¿€å…‰åŠŸèƒ½ï¼ˆå¦‚æœå·²è·å¾—ï¼‰ã€‚</p>
            <p>ä¹Ÿå¯ä»¥ä½¿ç”¨é”®ç›˜å·¦å³ç®­å¤´ç§»åŠ¨æŒ¡æ¿ã€‚</p>
            <p>æŒ‰ESCé”®æš‚åœæ¸¸æˆã€‚</p>
            <p>åœ¨æ‰‹æœºä¸Šç”¨æ‰‹æŒ‡å·¦å³æ»‘åŠ¨æ§åˆ¶æŒ¡æ¿ã€‚</p>
            <p>ç‚¹å‡»è°ƒè¯•æŒ‰é’®å¯ä»¥å¼€å¯è°ƒè¯•æ¨¡å¼ã€‚</p>
            <button class="game-btn" id="closeHowToPlayBtn">å…³é—­è¯´æ˜</button>
        </div>
        
        <!-- æ¸¸æˆçŠ¶æ€ä¿¡æ¯é¢æ¿ -->
        <div id="gameDebugInfo"></div>
    </div>

    <!-- å·¥å…·ç±»åº“ - éæ¨¡å—æ–¹å¼åŠ è½½ -->
    <script src="./js/utils.js"></script>
    <script src="./js/levels.js"></script>
    <script src="./js/ball.js"></script>
    <script src="./js/player.js"></script>
    <script src="./js/powerups.js"></script>
    <script src="./js/score.js"></script>
    <script src="./js/game.js"></script>
    
    <!-- åˆå§‹åŒ–æ¸¸æˆ -->
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            // ç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆåå†åˆå§‹åŒ–æ¸¸æˆ
            console.log('å¼€å§‹åˆå§‹åŒ–æ¸¸æˆ...');
            
            // ç¦ç”¨é¡µé¢ç¼©æ”¾å’Œæ»šåŠ¨
            document.addEventListener('touchmove', function(e) {
                if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // é˜²æ­¢åŒå‡»ç¼©æ”¾
            document.addEventListener('dblclick', function(e) {
                e.preventDefault();
            }, { passive: false });
            
            // ä½¿æ¸¸æˆç”»å¸ƒä¿æŒé€‚å½“å¤§å°
            function resizeCanvas() {
                const gameContainer = document.getElementById('gameContainer');
                const canvas = document.getElementById('gameCanvas');
                if (!canvas) return;
                
                const maxWidth = Math.min(600, window.innerWidth - 20);
                const maxHeight = window.innerHeight - 20;
                
                // è®¾ç½®åˆå§‹å¤§å°
                canvas.width = maxWidth;
                canvas.height = maxHeight * 0.8;
                
                console.log('ç”»å¸ƒå¤§å°å·²è°ƒæ•´:', canvas.width, 'x', canvas.height);
            }
            
            // åˆå§‹è°ƒæ•´å¤§å°
            resizeCanvas();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', resizeCanvas);
            
            // åˆ›å»ºæ¸¸æˆå®ä¾‹
            try {
                window.game = new BrickGame();
                console.log('æ¸¸æˆåˆå§‹åŒ–æˆåŠŸ!');
            } catch (error) {
                console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
                alert('æ¸¸æˆåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•: ' + error.message);
            }
        });
    </script>
</body>
</html>
